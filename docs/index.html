<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ts-duckling playground</title>
    <meta
      name="description"
      content="Parse text into structured entities using ts-duckling. Runs fully in your browser."
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: [
                "ui-sans-serif",
                "system-ui",
                "-apple-system",
                "Segoe UI",
                "sans-serif",
              ],
              mono: [
                "ui-monospace",
                "SFMono-Regular",
                "Menlo",
                "Monaco",
                "Consolas",
                "Liberation Mono",
                "Courier New",
                "monospace",
              ],
            },
          },
        },
      };
    </script>
    <style>
      html {
        font-size: 18px;
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "ts-duckling": "https://esm.sh/gh/ClaudiuCeia/ts-duckling@main/mod.ts",
          "@mozilla/readability": "https://esm.sh/@mozilla/readability@0.6.0"
        }
      }
    </script>
  </head>
  <body>
    <header
      class="sticky top-0 z-10 border-b border-slate-200/80 bg-slate-50/80 backdrop-blur"
    >
      <div class="mx-auto max-w-7xl px-6 py-4">
        <div class="flex items-start justify-between gap-6">
          <div class="flex items-start gap-4">
            <img
              src="./logo.png"
              alt="ts-duckling logo"
              class="h-14 w-14 rounded-2xl border border-slate-200 bg-white shadow-sm"
            />
            <div class="min-w-0">
              <div class="flex flex-wrap items-center gap-x-3 gap-y-2">
                <h1 class="text-xl font-semibold tracking-tight text-slate-900">
                  ts-duckling
                </h1>
                <a
                  href="https://github.com/ClaudiuCeia/ts-duckling"
                  target="_blank"
                  rel="noreferrer"
                  class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1 text-sm font-medium text-slate-700 hover:border-slate-300 hover:text-slate-900"
                >
                  <svg
                    viewBox="0 0 16 16"
                    width="16"
                    height="16"
                    aria-hidden="true"
                  >
                    <path
                      fill="currentColor"
                      d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8Z"
                    >
                    </path>
                  </svg>
                  Repo
                </a>
              </div>
              <p class="mt-1 max-w-2xl text-sm leading-relaxed text-slate-600">
                A tiny, deterministic entity extractor for TypeScript/Deno,
                inspired by Duckling. This version uses parser-combinator
                grammars (no ML). It works best on small to medium text, where
                you can tolerate false positives and tune rules over time.
              </p>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <span
              id="status"
              class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-700 shadow-sm"
              aria-live="polite"
            >
              <span
                id="status-spinner"
                class="hidden h-3 w-3 animate-spin rounded-full border-2 border-slate-300 border-t-teal-600"
                aria-hidden="true"
              ></span>
              <span id="status-text"></span>
            </span>
            <button
              id="btn-run"
              type="button"
              class="rounded-xl border border-teal-200 bg-teal-50 px-4 py-2 text-sm font-semibold text-teal-900 hover:border-teal-300 hover:bg-teal-100"
            >
              Extract
            </button>
            <button
              id="btn-stop"
              type="button"
              class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-300"
            >
              Stop
            </button>
            <button
              id="btn-clear"
              type="button"
              class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-900 hover:border-slate-300"
            >
              Clear
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-7xl px-6 py-6">
      <div class="grid grid-cols-1 gap-4 lg:grid-cols-[360px_1fr]">
        <section class="rounded-2xl border border-slate-200 bg-white shadow-sm">
          <div
            class="flex items-center justify-between border-b border-slate-200 px-4 py-3"
          >
            <h2 class="text-sm font-semibold tracking-wide text-slate-900">
              Parsers
            </h2>
            <div class="text-sm text-slate-500">
              <span id="parser-count">0</span> selected
            </div>
          </div>
          <div class="p-4">
            <div class="flex flex-wrap gap-2 pb-3">
              <button
                id="preset-all"
                class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-900 hover:border-slate-300"
                type="button"
              >
                All
              </button>
              <button
                id="preset-none"
                class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-900 hover:border-slate-300"
                type="button"
              >
                None
              </button>
              <button
                id="preset-pii"
                class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-900 hover:border-slate-300"
                type="button"
              >
                PII
              </button>
              <button
                id="preset-default"
                class="rounded-lg border border-slate-200 bg-slate-50 px-3 py-1.5 text-sm font-semibold text-slate-900 hover:border-slate-300"
                type="button"
              >
                Default
              </button>
            </div>
            <div id="parser-list" class="space-y-2" role="list"></div>
            <div
              class="mt-4 rounded-xl border border-amber-200 bg-amber-50 p-3 text-sm text-amber-900"
            >
              Tip: for large articles, start with `PII` or a smaller max-chars
              limit below. Full extraction is intentionally naive and can be
              slow.
            </div>
          </div>
        </section>

        <div class="space-y-4">
          <section
            class="rounded-2xl border border-slate-200 bg-white shadow-sm"
          >
            <div
              class="flex items-center justify-between border-b border-slate-200 px-4 py-3"
            >
              <h2 class="text-sm font-semibold tracking-wide text-slate-900">
                Input
              </h2>
              <div class="text-sm text-slate-500">
                <span id="char-count">0</span> chars
              </div>
            </div>
            <div class="p-4">
              <div class="grid grid-cols-1 gap-3 md:grid-cols-[160px_1fr_auto]">
                <label class="text-sm text-slate-600">
                  <div class="mb-1 font-medium text-slate-700">Preset</div>
                  <select
                    id="preset-text"
                    class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-900 shadow-sm focus:border-teal-300 focus:outline-none focus:ring-4 focus:ring-teal-200/40"
                  >
                    <option value="">(none)</option>
                    <option value="mixed">Mixed</option>
                    <option value="pii">PII</option>
                    <option value="article">Article-ish</option>
                  </select>
                </label>

                <label class="text-sm text-slate-600">
                  <div class="mb-1 font-medium text-slate-700">URL</div>
                  <input
                    id="url"
                    type="text"
                    placeholder="https://en.wikipedia.org/wiki/Perceptual_hashing"
                    class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-900 shadow-sm placeholder:text-slate-400 focus:border-teal-300 focus:outline-none focus:ring-4 focus:ring-teal-200/40"
                  />
                </label>

                <div class="flex items-end">
                  <button
                    id="btn-load"
                    class="w-full rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-900 shadow-sm hover:border-slate-300 md:w-auto"
                    type="button"
                  >
                    Load
                  </button>
                </div>
              </div>

              <div class="mt-3">
                <label class="text-sm text-slate-600">
                  <div class="mb-1 font-medium text-slate-700">Max chars</div>
                  <div class="flex items-center gap-2">
                    <input
                      id="max-chars"
                      type="number"
                      min="500"
                      step="500"
                      value="8000"
                      class="w-32 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-900 shadow-sm focus:border-teal-300 focus:outline-none focus:ring-4 focus:ring-teal-200/40"
                    />
                    <label
                      class="flex items-center gap-2 text-sm font-medium text-slate-700"
                    >
                      <input
                        id="full-text"
                        type="checkbox"
                        class="h-4 w-4 accent-teal-600"
                      />
                      Full text (slow)
                    </label>
                  </div>
                </label>
                <div class="mt-2 text-sm text-slate-500">
                  For big pages, we parse a prefix to keep the browser
                  responsive. Extraction runs in a background worker.
                </div>
              </div>

              <textarea
                id="input"
                spellcheck="false"
                class="mt-4 h-56 w-full resize-y rounded-2xl border border-slate-200 bg-white p-4 font-mono text-sm leading-relaxed text-slate-900 shadow-sm focus:border-teal-300 focus:outline-none focus:ring-4 focus:ring-teal-200/40"
                placeholder="Try: Email me at no-reply+foo@some.domain.dev, call +14155552671, visit https://duckling.deno.dev/, SSN 123-45-6789, CC 4242 4242 4242 4242"
              ></textarea>
            </div>
          </section>

          <section
            class="rounded-2xl border border-slate-200 bg-white shadow-sm"
          >
            <div
              class="flex items-center justify-between border-b border-slate-200 px-4 py-3"
            >
              <h2 class="text-sm font-semibold tracking-wide text-slate-900">
                Preview
              </h2>
              <div class="flex items-center gap-3 text-sm text-slate-500">
                <span><span id="match-count">0</span> matches</span>
                <span class="text-slate-300">â€¢</span>
                <span id="timing" class="font-mono text-slate-600"></span>
                <label
                  class="flex items-center gap-2 font-medium text-slate-700"
                >
                  <input
                    id="toggle-json"
                    type="checkbox"
                    class="h-4 w-4 accent-teal-600"
                  />
                  Show JSON
                </label>
              </div>
            </div>
            <div class="p-4">
              <div
                class="text-xs font-semibold uppercase tracking-widest text-slate-500"
              >
                Annotated text
              </div>
              <div
                id="annotated"
                class="mt-2 min-h-[120px] rounded-2xl border border-slate-200 bg-white p-4 font-mono text-sm leading-relaxed text-slate-900"
                aria-live="polite"
              >
              </div>

              <div id="json-wrap" class="mt-3 hidden">
                <div
                  class="text-xs font-semibold uppercase tracking-widest text-slate-500"
                >
                  Raw JSON
                </div>
                <pre
                  id="json"
                  class="mt-2 max-h-80 overflow-auto rounded-2xl border border-slate-200 bg-white p-4 font-mono text-xs leading-relaxed text-slate-900"
                ></pre>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>

    <div
      id="hovercard"
      class="fixed z-30 hidden w-[min(520px,calc(100vw-2rem))]"
      role="dialog"
      aria-label="Match details"
    >
      <div class="rounded-2xl border border-slate-200 bg-white shadow-xl">
        <div
          class="flex items-start justify-between gap-4 border-b border-slate-200 px-4 py-3"
        >
          <div class="min-w-0">
            <div
              class="text-xs font-semibold uppercase tracking-widest text-slate-500"
            >
              Match
            </div>
            <div
              id="hovercard-title"
              class="mt-1 truncate font-mono text-sm text-slate-900"
            >
            </div>
            <div id="hovercard-tabs" class="mt-2 flex flex-wrap gap-2"></div>
          </div>
          <button
            id="hovercard-close"
            type="button"
            class="shrink-0 rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-900 hover:border-slate-300"
          >
            Close
          </button>
        </div>
        <div class="p-4">
          <pre
            id="hovercard-json"
            class="max-h-[50vh] overflow-auto rounded-2xl border border-slate-200 bg-white p-4 font-mono text-xs leading-relaxed text-slate-900"
          ></pre>
        </div>
      </div>
    </div>

    <script>
      globalThis.__TS_DUCKLING_BUILD__ = "__BUILD_SHA__";
    </script>
    <script type="module" src="./app.js?v=__BUILD_SHA__"></script>
  </body>
</html>
